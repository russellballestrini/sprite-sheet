<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sprite Sheet Library - Modern Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 30px;
    }

    h1 {
      color: #333;
      margin-bottom: 8px;
      font-size: 2em;
    }

    .subtitle {
      color: #666;
      margin-bottom: 20px;
      font-size: 1em;
    }

    .canvas-container {
      background: #f5f5f5;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      display: grid;
      place-items: center;
      min-height: 150px;
      max-height: 300px;
      overflow: hidden;
    }

    canvas {
      border: 2px solid #ddd;
      border-radius: 5px;
      background: white;
      max-width: 100%;
      height: auto;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    .playback-controls {
      display: grid;
      gap: 12px;
      margin-bottom: 20px;
    }

    .controls {
      display: grid;
      gap: 15px;
      margin-bottom: 20px;
    }

    .control-group {
      display: grid;
      gap: 8px;
    }

    label {
      font-weight: 600;
      color: #555;
      font-size: 0.9em;
    }

    input[type="text"],
    input[type="number"],
    input[type="file"] {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-info {
      background: #3b82f6;
      color: white;
    }

    .frame-indicator {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 1.2em;
      font-weight: 600;
      color: #333;
    }

    .info-box {
      background: #e0e7ff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
    }

    .info-box h3 {
      color: #4338ca;
      margin-bottom: 10px;
    }

    .info-box p {
      color: #4338ca;
      line-height: 1.6;
    }

    .code-example {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sprite Sheet Library</h1>
    <p class="subtitle">Modern HTML5 sprite sheet animation for games and web apps</p>

    <div class="canvas-container">
      <canvas id="spriteCanvas" width="400" height="400"></canvas>
    </div>

    <div class="playback-controls">
      <div class="frame-indicator">
        Frame: <span id="frameDisplay">1</span> / <span id="totalFrames">1</span>
      </div>
      <div class="button-group">
        <button class="btn-success" onclick="app.togglePlay()" id="playButton">Play</button>
        <button class="btn-warning" onclick="app.prevFrame()">◄ Prev</button>
        <button class="btn-warning" onclick="app.nextFrame()">Next ►</button>
        <button class="btn-info" onclick="app.reset()">Reset</button>
      </div>
    </div>

    <div class="controls">
      <div class="control-group">
        <label>Sprite Sheet URL:</label>
        <input type="text" id="urlInput" value="https://opengameart.org/sites/default/files/Green-Cap-Character-16x18.png" placeholder="Enter sprite sheet URL">
      </div>

      <div class="grid-3">
        <div class="control-group">
          <label>Frame Width:</label>
          <input type="number" id="widthInput" value="16" min="1">
        </div>
        <div class="control-group">
          <label>Frame Height:</label>
          <input type="number" id="heightInput" value="18" min="1">
        </div>
        <div class="control-group">
          <label>Padding:</label>
          <input type="number" id="paddingInput" value="0" min="0">
        </div>
      </div>

      <div class="grid-2">
        <div class="control-group">
          <label>Total Frames:</label>
          <input type="number" id="framesInput" value="12" min="1">
        </div>
        <div class="control-group">
          <label>Framerate (ms):</label>
          <input type="number" id="framerateInput" value="100" min="1">
        </div>
      </div>

      <div class="grid-2">
        <div class="control-group">
          <label>Rows:</label>
          <input type="number" id="rowsInput" value="4" min="1">
        </div>
        <div class="control-group">
          <label>Columns:</label>
          <input type="number" id="columnsInput" value="3" min="0" placeholder="Auto">
        </div>
      </div>

      <div class="control-group">
        <label>Upload Image:</label>
        <input type="file" id="fileInput" accept="image/*">
      </div>

      <button class="btn-primary" onclick="app.updateSprite()">Update Sprite</button>
    </div>

    <div class="info-box">
      <h3>How to Use in Your Game</h3>
      <p>This library provides a simple API for sprite sheet animations. Here's a basic example:</p>
      <div class="code-example">import { SpriteSheet } from './src/SpriteSheet.js';

// Create a sprite sheet
const sprite = new SpriteSheet({
  canvas: '#myCanvas',
  image: 'character.png',
  frameWidth: 32,
  frameHeight: 32,
  frames: 8,
  framerate: 100,
  rows: 1,
  onFrameChange: (frame) => {
    console.log('Frame:', frame);
  }
});

// Wait for image to load, then play
await sprite.ready();
sprite.play();</div>
    </div>
  </div>

  <script type="module">
    import { SpriteSheet, fromFile } from './src/SpriteSheet.js';

    class DemoApp {
      constructor() {
        this.sprite = null;
        this.scale = 1;
        this.scaledWidth = 0;
        this.scaledHeight = 0;
        this.offsetX = 0;
        this.offsetY = 0;
        this.init();
      }

      async init() {
        // Create initial sprite
        await this.updateSprite();

        // Setup file input
        document.getElementById('fileInput').addEventListener('change', (e) => {
          this.handleFileUpload(e);
        });
      }

      async updateSprite() {
        const canvas = document.getElementById('spriteCanvas');
        const url = document.getElementById('urlInput').value;
        const frameWidth = parseInt(document.getElementById('widthInput').value);
        const frameHeight = parseInt(document.getElementById('heightInput').value);
        const frames = parseInt(document.getElementById('framesInput').value);
        const framerate = parseInt(document.getElementById('framerateInput').value);
        const padding = parseInt(document.getElementById('paddingInput').value);
        const rows = parseInt(document.getElementById('rowsInput').value);
        const columns = parseInt(document.getElementById('columnsInput').value) || 0;

        // Destroy old sprite if exists
        if (this.sprite) {
          this.sprite.destroy();
        }

        try {
          // Create new sprite
          this.sprite = new SpriteSheet({
            canvas: canvas,
            image: url,
            frameWidth: frameWidth,
            frameHeight: frameHeight,
            frames: frames,
            framerate: framerate,
            padding: padding,
            rows: rows,
            columns: columns,
            onFrameChange: (frame) => {
              document.getElementById('frameDisplay').textContent = frame + 1;
              // We'll override drawFrame behavior after setup
            }
          });

          await this.sprite.ready();

          // Update canvas size to fit sprite with proper scaling
          // Scale up small sprites for better visibility
          this.scale = Math.min(8, Math.max(2, Math.floor(200 / Math.max(frameWidth, frameHeight))));
          this.scaledWidth = frameWidth * this.scale;
          this.scaledHeight = frameHeight * this.scale;

          canvas.width = this.scaledWidth + 40;
          canvas.height = this.scaledHeight + 40;

          // Clear the entire canvas
          this.sprite.clear();

          // Center the sprite
          this.offsetX = (canvas.width - this.scaledWidth) / 2;
          this.offsetY = (canvas.height - this.scaledHeight) / 2;

          // Override the sprite's drawFrame to always use scaling and centering
          const originalDrawFrame = this.sprite.drawFrame.bind(this.sprite);
          this.sprite.drawFrame = (frameIndex, x, y, width, height) => {
            // If called with default parameters (from animation), use our scaling
            if (x === undefined || x === 0) {
              return originalDrawFrame(frameIndex, this.offsetX, this.offsetY, this.scaledWidth, this.scaledHeight);
            }
            return originalDrawFrame(frameIndex, x, y, width, height);
          };

          this.sprite.drawFrame(0);

          document.getElementById('totalFrames').textContent = frames;
          document.getElementById('frameDisplay').textContent = '1';
          document.getElementById('playButton').textContent = 'Play';
        } catch (error) {
          console.error('Error loading sprite:', error);
          alert('Failed to load sprite sheet. Please check the URL and settings.');
        }
      }

      async handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        try {
          const reader = new FileReader();
          reader.onload = (e) => {
            document.getElementById('urlInput').value = e.target.result;
            this.updateSprite();
          };
          reader.readAsDataURL(file);
        } catch (error) {
          console.error('Error loading file:', error);
          alert('Failed to load image file.');
        }
      }

      togglePlay() {
        if (!this.sprite) return;

        this.sprite.toggle();
        const button = document.getElementById('playButton');
        button.textContent = this.sprite.isPlaying ? 'Stop' : 'Play';
      }

      nextFrame() {
        if (!this.sprite) return;
        this.sprite.nextFrame();
      }

      prevFrame() {
        if (!this.sprite) return;
        this.sprite.prevFrame();
      }

      reset() {
        if (!this.sprite) return;
        this.sprite.reset();
        document.getElementById('playButton').textContent = 'Play';
      }
    }

    // Make app globally accessible
    window.app = new DemoApp();
  </script>
</body>
</html>
